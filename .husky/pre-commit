#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run lint-staged
pnpm lint-staged || exit 1

check_if_CHANGELOG_file_updated() {
  if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
    echo "[CHECKIT] Skipping CHANGELOG check (initial commit, no HEAD)"
    return 0
  fi

  BRANCH=$(git rev-parse --abbrev-ref HEAD)

  if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "dev" ]; then
    echo "[CHECKIT] Maybe CHANGELOG file not updated!"
    git diff --cached --name-only | grep '^CHANGELOG.md$' || echo "❗️CHANGELOG.md was not updated."
  fi

  return 0
}

check_if_CHANGELOG_file_updated
